<ion-header>
  <app-header titulo="Consultas"></app-header>
</ion-header>

<ion-content class="ion-padding">
  <div class="filtros-container">
    <div class="filtros-grid">
      <div class="campo">
        <label for="coleccion">Base de Datos</label>
        <ion-select
          id="coleccion"
          [(ngModel)]="coleccionSeleccionada"
          interface="popover"
          placeholder="Selecciona una colección"
          (ionChange)="onColeccionChange()"
        >
          <ion-select-option *ngFor="let c of colecciones" [value]="c.valor">
            {{ c.nombre }}
          </ion-select-option>
        </ion-select>
      </div>

      <div class="campo">
        <label for="termino">Término de Búsqueda</label>
        <ion-input
          id="termino"
          [(ngModel)]="terminoBusqueda"
          (ionInput)="buscarDatos()"
          clearInput
          placeholder="Escribe aquí..."
        ></ion-input>
      </div>
    </div>
  </div>

  <div class="resultados-container" *ngIf="coleccionSeleccionada">
    <ion-item>
      <ion-label>
        <ion-checkbox
          slot="start"
          [checked]="clientesSeleccionados.size === resultados.length && resultados.length>0"
          (ionChange)="toggleSeleccionTodos($event)"
        ></ion-checkbox>
        Seleccionar todos
      </ion-label>
    </ion-item>

    <ion-button
      *ngIf="clientesSeleccionados.size > 0"
      expand="block"
      color="danger"
      (click)="borrarElementosSeleccionados()"
    >
      Borrar Seleccionados
    </ion-button>

    <ion-list>
      <ion-item *ngFor="let item of resultados" button (click)="verDetalles(item)">
        <ion-checkbox
          slot="start"
          [checked]="clientesSeleccionados.has(item._id)"
          (ionChange)="toggleClienteSeleccionado(item._id); $event.stopPropagation()"
        ></ion-checkbox>
        <ion-label>
          <h2>{{ obtenerNombreVisible(item) }}</h2>
          <p>{{ getSubtitulo(item) }}</p>
        </ion-label>
        <ion-icon slot="end" name="chevron-forward-outline"></ion-icon>
      </ion-item>
    </ion-list>

    <ion-text color="medium" *ngIf="resultados.length === 0 && terminoBusqueda">
      <p class="no-result-text">
        No se encontraron resultados para "{{ terminoBusqueda }}"
      </p>
    </ion-text>
  </div>
</ion-content>
